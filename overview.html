<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Overview &mdash; cuDecomp 2022 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/style.css" type="text/css" />
      <link rel="stylesheet" href="_static/tabs.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Basic Usage Guide" href="basic_usage.html" />
    <link rel="prev" title="cuDecomp: An Adaptive Pencil Decomposition Library for NVIDIA GPUs" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" > 
            <a href="index.html" class="icon icon-home"> cuDecomp
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

  <style>
    /* Sidebar header (and topbar for mobile) */
    .wy-side-nav-search, .wy-nav-top {
      background: #76b900;
    }

    .wy-side-nav-search a:link, .wy-nav-top a:link {
      color: #fff;
    }
    .wy-side-nav-search a:visited, .wy-nav-top a:visited {
      color: #fff;
    }
    .wy-side-nav-search a:hover, .wy-nav-top a:hover {
      color: #fff;
    }

    .wy-menu-vertical a:link, .wy-menu-vertical a:visited {
      color: #d9d9d9
    }

    .wy-menu-vertical a:active {
      background-color: #76b900
    }

    .wy-side-nav-search>div.version {
      color: rgba(0, 0, 0, 0.3)
    }
  </style>
  
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Overview</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#what-is-cudecomp">What is cuDecomp?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#decomposition-layout">Decomposition Layout</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="basic_usage.html">Basic Usage Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="basic_usage.html#starting-up-cudecomp">Starting up cuDecomp</a></li>
<li class="toctree-l2"><a class="reference internal" href="basic_usage.html#creating-a-grid-descriptor">Creating a grid descriptor</a></li>
<li class="toctree-l2"><a class="reference internal" href="basic_usage.html#allocate-pencil-memory">Allocate pencil memory</a></li>
<li class="toctree-l2"><a class="reference internal" href="basic_usage.html#working-with-pencil-data">Working with pencil data</a><ul>
<li class="toctree-l3"><a class="reference internal" href="basic_usage.html#c-c">C/C++</a></li>
<li class="toctree-l3"><a class="reference internal" href="basic_usage.html#fortran">Fortran</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="basic_usage.html#allocating-workspace">Allocating workspace</a></li>
<li class="toctree-l2"><a class="reference internal" href="basic_usage.html#transposing-the-data">Transposing the data</a></li>
<li class="toctree-l2"><a class="reference internal" href="basic_usage.html#updating-halo-regions">Updating halo regions</a></li>
<li class="toctree-l2"><a class="reference internal" href="basic_usage.html#cleaning-up-and-finalizing-the-library">Cleaning up and finalizing the library</a></li>
<li class="toctree-l2"><a class="reference internal" href="basic_usage.html#building-and-running-the-example">Building and running the example</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="autotuning.html">Autotuning</a><ul>
<li class="toctree-l2"><a class="reference internal" href="autotuning.html#autotuning-process">Autotuning process</a></li>
<li class="toctree-l2"><a class="reference internal" href="autotuning.html#autotuning-usage">Autotuning usage</a><ul>
<li class="toctree-l3"><a class="reference internal" href="autotuning.html#creating-a-grid-descriptor-with-autotuning-enabled">Creating a grid descriptor with autotuning enabled</a></li>
<li class="toctree-l3"><a class="reference internal" href="autotuning.html#autotuner-output-and-querying-results">Autotuner output and querying results</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="nvshmem.html">Working with NVSHMEM-enabled builds</a><ul>
<li class="toctree-l2"><a class="reference internal" href="nvshmem.html#controlling-the-symmetric-heap-size">Controlling the symmetric heap size</a></li>
<li class="toctree-l2"><a class="reference internal" href="nvshmem.html#mpi-compatibility">MPI compatibility</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="api.html">cuDecomp API</a><ul>
<li class="toctree-l2"><a class="reference internal" href="api/c_api.html">cuDecomp C API</a><ul>
<li class="toctree-l3"><a class="reference internal" href="api/c_api.html#types">Types</a><ul>
<li class="toctree-l4"><a class="reference internal" href="api/c_api.html#internal-types">Internal types</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/c_api.html#grid-descriptor-configuration">Grid Descriptor Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/c_api.html#pencil-information">Pencil Information</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/c_api.html#communication-backends">Communication Backends</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/c_api.html#additional-enumerators">Additional Enumerators</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="api/c_api.html#functions">Functions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="api/c_api.html#library-initialization-finalization">Library Initialization/Finalization</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/c_api.html#grid-descriptor-management">Grid Descriptor Management</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/c_api.html#workspace-management">Workspace Management</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/c_api.html#helper-functions">Helper Functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/c_api.html#transposition-functions">Transposition Functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/c_api.html#halo-exchange-functions">Halo Exchange Functions</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="api/f_api.html">cuDecomp Fortran API</a><ul>
<li class="toctree-l3"><a class="reference internal" href="api/f_api.html#types">Types</a><ul>
<li class="toctree-l4"><a class="reference internal" href="api/f_api.html#internal-types">Internal types</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/f_api.html#grid-descriptor-configuration">Grid Descriptor Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/f_api.html#pencil-information">Pencil Information</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/f_api.html#communication-backends">Communication Backends</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/f_api.html#additional-enumerators">Additional Enumerators</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="api/f_api.html#functions">Functions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="api/f_api.html#library-initialization-finalization">Library Initialization/Finalization</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/f_api.html#grid-descriptor-management">Grid Descriptor Management</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/f_api.html#workspace-management">Workspace Management</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/f_api.html#helper-functions">Helper Functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/f_api.html#transposition-functions">Transposition Functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/f_api.html#halo-exchange-functions">Halo Exchange Functions</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">cuDecomp</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Overview</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/overview.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="overview">
<h1>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h1>
<section id="what-is-cudecomp">
<h2>What is cuDecomp?<a class="headerlink" href="#what-is-cudecomp" title="Permalink to this headline">¶</a></h2>
<p>cuDecomp is a library for managing 1D (slab) and 2D (pencil) parallel decompositions of
3D Cartesian spatial domains on NVIDIA GPUs, with routines to perform global transpositions and halo communication.
The library is inspired by the <a class="reference external" href="https://github.com/xcompact3d/2decomp-fft">2DECOMP&amp;FFT Fortran library</a> , a popular
decomposition library for numerical simulation codes, with a similar set of available transposition routines.
While 2DECOMP&amp;FFT and similar libraries in the past have been written to target CPU systems, this
library is designed for GPU systems, leveraging CUDA-aware MPI and additional communication
libraries optimized for GPUs, like the <a class="reference external" href="https://github.com/NVIDIA/nccl">NVIDIA Collective Communication Library (NCCL)</a> and
<a class="reference external" href="https://developer.nvidia.com/nvshmem">NVIDIA OpenSHMEM Library (NVSHMEM)</a>.</p>
<p>It is typical for modern GPU systems to have a hierarchy of connections between peer GPUs with wide-ranging bandwidths,
from fast P2P connections through NVLINK/NVSWITCH between GPUs within a single compute node, to relatively slower
inter-node network connections via Infiniband or Ethernet. Multi-socket nodes can also introduce cross-socket CPU connections
where direct NVLINK connections are not available between GPUs. As a user, it can be challenging to navigate these
various topologies and choose an appropriate decomposition of the domain to optimize network performance for their
workload. To add to this complexity, there are numerous communication libraries available for GPUs to choose from,
with performance characteristics for GPUs varying based on these system topologies, scale, message sizes (and for MPI,
the particular implementation used). To address this challenge, cuDecomp has a runtime autotuning feature that can
sweep across possible domain decompositions and several communication backends using different communication
libraries to find the option that minimizes either the transposition or halo communication time. For applications
that require global transpositions (e.g., FFT-based solvers, ADI solvers), the time to transpose the domain is generally
a large bottleneck, so minimizing this time is often key to ensuring good solver performance. Using autotuning, cuDecomp can
assist users in maintaining high computational performance across problem sizes and clusters. See the autotuning section [link]
for more information on this feature.</p>
</section>
<section id="decomposition-layout">
<h2>Decomposition Layout<a class="headerlink" href="#decomposition-layout" title="Permalink to this headline">¶</a></h2>
<p>cuDecomp can distribute 3D Cartesian domains with dimensions <span class="math notranslate nohighlight">\([X, Y, Z]\)</span>, in column-major order, which we will call
the <em>global grid</em>. The global grid is decomposed
across <span class="math notranslate nohighlight">\(N_{\text{GPU}}\)</span> processes in a 2D <strong>process grid</strong> with dimensions <span class="math notranslate nohighlight">\(P_{\text{row}} \times P_{\text{col}}\)</span>. The processes
are logically grouped by column and row index into <span class="math notranslate nohighlight">\(P_{\text{row}}\)</span> <em>row</em> communicators and <span class="math notranslate nohighlight">\(P_{\text{col}}\)</span> <em>column</em> communicators.
For consistency with <code class="code docutils literal notranslate"><span class="pre">MPI_Cart_*</span></code> routines, the ranks are assigned in a row-major ordering (i.e. row communicators
are composed of sequential ranks).</p>
<p>cuDecomp will distribute the global domain data so that each process is assigned a unique <em>pencil</em> of data, with three different
pencil configurations corresponding to different transposed configurations of the global domain. The domain can be
decomposed into <span class="math notranslate nohighlight">\(X\)</span>-axis aligned pencils (<span class="math notranslate nohighlight">\(X\)</span>-pencils), where the <span class="math notranslate nohighlight">\(Y\)</span> and <span class="math notranslate nohighlight">\(Z\)</span> dimensions are split across
the process grid,
<span class="math notranslate nohighlight">\(Y\)</span>-axis aligned pencils (<span class="math notranslate nohighlight">\(Y\)</span>-pencils), where the <span class="math notranslate nohighlight">\(X\)</span> and <span class="math notranslate nohighlight">\(Z\)</span> dimensions are split across the process grid,
or <span class="math notranslate nohighlight">\(Z\)</span>-axis aligned pencils
(<span class="math notranslate nohighlight">\(Z\)</span>-pencils), where the <span class="math notranslate nohighlight">\(X\)</span> and <span class="math notranslate nohighlight">\(Y\)</span> dimensions are split across the process grid. The shapes of these pencils are approximately:</p>
<table class="docutils align-center">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(X\)</span>-pencils</p></td>
<td><p><span class="math notranslate nohighlight">\([X, \; Y/P_{\text{row}}, \; Z/P_{\text{col}}]\)</span></p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(Y\)</span>-pencils</p></td>
<td><p><span class="math notranslate nohighlight">\([X/P_{\text{row}}, \; Y, \; Z/P_{\text{col}}]\)</span></p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(Z\)</span>-pencils</p></td>
<td><p><span class="math notranslate nohighlight">\([X/P_{\text{row}}, \; Y/P_{\text{col}}, \; Z]\)</span></p></td>
</tr>
</tbody>
</table>
<p>In the case where the global dimension is not evenly divisible by <span class="math notranslate nohighlight">\(P_{\text{row}}\)</span> or <span class="math notranslate nohighlight">\(P_{\text{col}}\)</span> in the formulas
above, the remainder is distributed across the row or column ranks starting from the lowest indexed rank.</p>
<p>A simple illustration of the decomposition using a <span class="math notranslate nohighlight">\(2 \times 2\)</span> process grid is shown below. From left to right, the illustration
shows the <span class="math notranslate nohighlight">\(X\)</span>-pencil, <span class="math notranslate nohighlight">\(Y\)</span>-pencil, and <span class="math notranslate nohighlight">\(Z\)</span>-pencil configurations, with associated rank assignments.</p>
<figure class="align-center">
<img alt="_images/decomposition.png" src="_images/decomposition.png" />
</figure>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="index.html" class="btn btn-neutral float-left" title="cuDecomp: An Adaptive Pencil Decomposition Library for NVIDIA GPUs" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="basic_usage.html" class="btn btn-neutral float-right" title="Basic Usage Guide" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, NVIDIA Corporation.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>  

  <style>
  a:link, a:visited {
    color: #76b900;
  }

  a:hover {
    color: #8c0;
  }

  .rst-content dl:not(.docutils) dt {
    background: rgba(118, 185, 0, 0.1);
    color: rgba(59,93,0,1);
    border-top: solid 3px rgba(59,93,0,1);
  }
  </style>
  

</body>
</html>